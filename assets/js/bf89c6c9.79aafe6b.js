"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[321],{2052:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var t=o(4848),i=o(8453);const r={},a="Creating your own VAC",s={id:"howto/creating_a_vac",title:"Creating your own VAC",description:"This is a step by step guide in creating your own VAC.",source:"@site/docs/howto/creating_a_vac.md",sourceDirName:"howto",slug:"/howto/creating_a_vac",permalink:"/docs/howto/creating_a_vac",draft:!1,unlisted:!1,editUrl:"https://github.com/sunholo-data/sunholo-py/tree/main/docs/docs/howto/creating_a_vac.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"A2A Agent for VACs",permalink:"/docs/howto/a2a_agent"},next:{title:"Embedding Pipelines",permalink:"/docs/howto/embedding"}},c={},l=[{value:"vac_service.py",id:"vac_servicepy",level:2},{value:"Streaming",id:"streaming",level:3},{value:"Images/Videos",id:"imagesvideos",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"creating-your-own-vac",children:"Creating your own VAC"})}),"\n",(0,t.jsx)(n.p,{children:"This is a step by step guide in creating your own VAC."}),"\n",(0,t.jsxs)(n.ol,{start:"0",children:["\n",(0,t.jsxs)(n.li,{children:["Install via ",(0,t.jsx)(n.code,{children:"pip install sunholo"})]}),"\n",(0,t.jsx)(n.li,{children:"Create a new git repository and browse to the root"}),"\n",(0,t.jsxs)(n.li,{children:["Run ",(0,t.jsx)(n.code,{children:"sunholo init new_project"}),' to create a project called "new_project"']}),"\n",(0,t.jsx)(n.li,{children:"This will create a new folder with an example project files."}),"\n",(0,t.jsxs)(n.li,{children:["Make your changes to the ",(0,t.jsx)(n.code,{children:"vac_service.py"})," file - specifically the ",(0,t.jsx)(n.code,{children:"vac"})," and ",(0,t.jsx)(n.code,{children:"vac_stream"})," functions"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"vac_servicepy",children:"vac_service.py"}),"\n",(0,t.jsxs)(n.p,{children:["This is the guts of your GenAI application.  You can optionally create a batch ",(0,t.jsx)(n.code,{children:"vac()"})," function and/or a ",(0,t.jsx)(n.code,{children:"vac_stream()"})," function that will be invoked when calling the VAC endpoints.  Additional arguments will be passed to help with common GenAI applicaton tasks.  Here is an example file that is used when doing ",(0,t.jsx)(n.code,{children:"sunholo init new_project"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from sunholo.logging import setup_logging\nfrom sunholo.utils.config import load_config_key\n\n# VAC specific imports\nfrom sunholo.vertex import init_vertex, get_vertex_memories\nfrom vertexai.preview.generative_models import GenerativeModel\n\nlog = setup_logging("template")\n\n#TODO: change this to a streaming VAC function\ndef vac_stream(question: str, vector_name, chat_history=[], callback=None, **kwargs):\n\n    rag_model = create_model(vector_name)\n\n    # example of image/video processing\n    url = None\n    if kwargs.get(\'image_uri\'):\n        log.info(f"Got image_url: {kwargs.get(\'image_url\')}")\n        url = kwargs["image_uri"]\n    else:\n        log.debug("No image_uri found")\n\n    mime = None\n    if kwargs.get(\'mime\'):\n        log.info(f"Got mime: {kwargs.get(\'image_url\')}")\n        mime = kwargs["mime"]\n    else:\n        log.debug("No mime found")\n\n    # streaming model calls\n    response = rag_model.generate_content(question, stream=True)\n    for chunk in response:\n        try:\n            callback.on_llm_new_token(token=chunk.text)\n        except ValueError as err:\n            callback.on_llm_new_token(token=str(err))\n    \n    callback.on_llm_end(response=response)\n    log.info(f"rag_model.response: {response}")\n\n    metadata = {\n        "chat_history": chat_history\n    }\n\n    return {"answer": response.text, "metadata": metadata}\n\n\n\n#TODO: change this to a batch VAC function\ndef vac(question: str, vector_name, chat_history=[], **kwargs):\n\n    rag_model = create_model(vector_name)\n\n    response = rag_model.generate_content(question)\n\n    log.info(f"Got response: {response}")\n\n    return {"answer": response.text}\n\n\n# TODO: common model setup to both batching and streaming\ndef create_model(vector_name):\n    gcp_config = load_config_key("gcp_config", vector_name=vector_name, kind="vacConfig")\n    if not gcp_config:\n        raise ValueError(f"Need config.{vector_name}.gcp_config to configure XXXX on VertexAI")\n\n    init_vertex(gcp_config)\n\n    config = ConfigManager(vector_name)\n    corpus_tools = get_vertex_memories(config)\n\n    model = load_config_key("model", vector_name=vector_name, kind="vacConfig")\n\n    # Create a gemini-pro model instance\n    # https://ai.google.dev/api/python/google/generativeai/GenerativeModel#streaming\n    rag_model = GenerativeModel(\n        model_name=model or "gemini-1.0-pro-002", tools=[corpus_tools]\n    )\n\n    return rag_model\n'})}),"\n",(0,t.jsx)(n.h3,{id:"streaming",children:"Streaming"}),"\n",(0,t.jsx)(n.p,{children:"As a minimum the streaming function needs these arguments:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"def vac_stream(question: str, vector_name, chat_history=[], callback=None, **kwargs):\n...\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"question"}),": the text of the question typcially sent by the user"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"vector_name"}),": the vector_name is an instance of your VAC, tailored to its own namespace.  AT least one is required per VAC, but you can many with different variations of prompt, model etc."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"chat_history"}),": A list of chat history messages"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"callback"}),": Do not add anything here, it will be used by the VAC to print out the streaming chat tokens."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"kwargs"}),": Any other additional arguments you may need, but can also include some listed below:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"image_uri"}),": the image URI location for image/video models"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"mime"}),": the MIME type of the URI location"]}),"\n",(0,t.jsx)(n.li,{children:"#TODO: more"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"imagesvideos",children:"Images/Videos"}),"\n",(0,t.jsx)(n.p,{children:"Images can be automatically inserted into your request arguments."}),"\n",(0,t.jsx)(n.p,{children:"Make a request to upload a new image via a POST form request.  The VAC will then upload that image to a Google Cloud Storage bucket, and return the URL, or if say the endpoint accepts base64 images pass that through."}),"\n",(0,t.jsxs)(n.p,{children:["The image and mime type are then available to your VACs in the ",(0,t.jsx)(n.code,{children:"kwargs"})," via ",(0,t.jsx)(n.code,{children:"uri"})," and ",(0,t.jsx)(n.code,{children:"mime"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'def vac_stream(question: str, vector_name: str, chat_history=[], callback=None, **kwargs):\n\n...\n    url = None\n    if kwargs.get(\'image_uri\'):\n        log.info(f"Got image_url: {kwargs.get(\'image_url\')}")\n        url = kwargs["image_uri"]\n    else:\n        log.debug("No image_uri found")\n\n    mime = None\n    if kwargs.get(\'mime\'):\n        log.info(f"Got mime: {kwargs.get(\'image_url\')}")\n        mime = kwargs["mime"]\n    else:\n        log.debug("No mime found")\n...\n'})})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>a,x:()=>s});var t=o(6540);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);